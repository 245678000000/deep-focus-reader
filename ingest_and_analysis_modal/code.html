<!DOCTYPE html>
<!-- [DONE] P0-1: æ–‡ä»¶ä¸Šä¼ è§£æä¸å…¥åº“æµç¨‹ - 2026-02-12 -->
<!-- [DONE] P1-3: ç§»åŠ¨ç«¯å¯¼èˆª - 2026-02-12 -->
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Deep Focus Reader - ä¸Šä¼ å¹¶è§£æè‹±è¯­é˜…è¯»ææ–™" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“–</text></svg>" />
  <title>Deep Focus Reader - Ingest & Analysis</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Spectral:wght@400;500;600;700&family=Crimson+Pro:wght@400;500;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#2c2925",
            "background-light": "#f7f7f7",
            "background-dark": "#1a1918",
            accent: "#C25E00"
          },
          fontFamily: {
            display: ["Space Grotesk", "sans-serif"],
            serif: ["Spectral", "serif"],
            english: ["Crimson Pro", "serif"]
          },
          borderRadius: {
            DEFAULT: "1rem",
            lg: "2rem",
            xl: "3rem",
            full: "9999px"
          }
        }
      }
    };
  </script>
  <style>
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-primary min-h-screen overflow-hidden">
  <main class="h-screen flex flex-col">
    <header class="px-4 sm:px-6 py-4 border-b border-primary/10 dark:border-white/10 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur">
      <div class="max-w-6xl mx-auto flex items-center justify-between gap-3">
        <div>
          <h1 class="font-serif text-2xl sm:text-3xl">Import Text</h1>
          <p class="text-sm text-primary/65 dark:text-white/65">ä¸Šä¼  PDF / DOCX / TXT / EPUBï¼Œè‡ªåŠ¨ç¿»è¯‘å¹¶è¿›å…¥é˜…è¯»é¡µã€‚</p>
        </div>
        <div class="flex items-center gap-2">
          <button id="themeToggle" class="min-h-[44px] min-w-[44px] h-11 w-11 rounded-full border border-primary/15 dark:border-white/20 hover:scale-105 active:scale-95 transition-all" aria-label="Toggle dark mode">
            <span class="material-icons-round">dark_mode</span>
          </button>
          <a href="../index.html" class="hidden md:flex min-h-[44px] px-4 rounded-full bg-primary text-white text-sm shadow-lg hover:scale-105 active:scale-95 transition-all items-center">Hub</a>
        </div>
      </div>
    </header>

    <section class="flex-1 overflow-y-auto no-scrollbar p-4 sm:p-6">
      <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-5">
        <article class="rounded-3xl border border-primary/10 dark:border-white/10 bg-white/75 dark:bg-white/5 p-6 sm:p-8 shadow-[0_2px_8px_rgba(44,41,37,0.04)]">
          <h2 class="font-serif text-2xl mb-1">Upload File</h2>
          <p class="text-sm text-primary/60 dark:text-white/60 mb-6">Supported: PDF / DOCX / TXT / EPUB</p>

          <div id="dropZone" class="group relative w-full min-h-[280px] border-2 border-dashed border-primary/25 dark:border-white/25 hover:border-accent rounded-2xl transition-all duration-300 bg-primary/[0.02] dark:bg-white/[0.04] p-6 flex flex-col items-center justify-center text-center cursor-pointer">
            <div class="w-16 h-16 rounded-full bg-white dark:bg-primary/20 shadow flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
              <span class="material-icons-round text-3xl text-primary/60 dark:text-white group-hover:text-accent transition-colors">upload_file</span>
            </div>
            <h3 class="font-medium text-lg mb-1">Drag & Drop File</h3>
            <p class="text-sm text-primary/50 dark:text-white/60 mb-4">or select from your computer</p>
            <button id="browseBtn" class="min-h-[44px] px-5 rounded-full bg-white dark:bg-primary/20 border border-primary/10 dark:border-white/20 hover:border-accent text-xs font-semibold uppercase tracking-wide shadow-sm transition-all" type="button">Browse Files</button>
            <input id="fileInput" type="file" accept=".pdf,.docx,.txt,.epub" class="hidden" />
          </div>

          <div class="mt-5 rounded-2xl border border-primary/10 dark:border-white/10 bg-background-light/70 dark:bg-white/5 p-4">
            <p class="text-xs uppercase tracking-wider text-primary/50 dark:text-white/50">Selected File</p>
            <p id="fileName" class="mt-1 text-sm text-primary/80 dark:text-white/80">æš‚æ— æ–‡ä»¶</p>
            <p id="fileStats" class="mt-1 text-xs text-primary/60 dark:text-white/60">ç­‰å¾…ä¸Šä¼ </p>
          </div>
        </article>

        <article class="rounded-3xl border border-primary/10 dark:border-white/10 bg-white/75 dark:bg-white/5 p-6 sm:p-8 shadow-[0_2px_8px_rgba(44,41,37,0.04)] flex flex-col">
          <div class="flex items-center justify-between mb-6">
            <h2 class="font-serif text-2xl">Analysis Status</h2>
            <span id="statusBadge" class="px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border bg-primary/10 text-primary border-primary/20">Idle</span>
          </div>

          <div class="space-y-5 flex-1">
            <div id="step-parse" class="flex items-start gap-3 opacity-60">
              <div id="icon-parse" class="mt-1 w-6 h-6 rounded-full border-2 border-primary/25"></div>
              <div>
                <h3 class="font-medium">1. Parsing Text</h3>
                <p id="detail-parse" class="text-xs text-primary/55 dark:text-white/55">ç­‰å¾…ä¸Šä¼ æ–‡ä»¶</p>
              </div>
            </div>
            <div id="step-translate" class="flex items-start gap-3 opacity-60">
              <div id="icon-translate" class="mt-1 w-6 h-6 rounded-full border-2 border-primary/25"></div>
              <div>
                <h3 class="font-medium">2. Translating Sentences</h3>
                <p id="detail-translate" class="text-xs text-primary/55 dark:text-white/55">ç­‰å¾…è§£æå®Œæˆ</p>
              </div>
            </div>
            <div id="step-audio" class="flex items-start gap-3 opacity-60">
              <div id="icon-audio" class="mt-1 w-6 h-6 rounded-full border-2 border-primary/25"></div>
              <div>
                <h3 class="font-medium">3. Audio Preparation</h3>
                <p id="detail-audio" class="text-xs text-primary/55 dark:text-white/55">ç­‰å¾…ç¿»è¯‘å®Œæˆ</p>
              </div>
            </div>
            <div id="step-analysis" class="flex items-start gap-3 opacity-60">
              <div id="icon-analysis" class="mt-1 w-6 h-6 rounded-full border-2 border-primary/25"></div>
              <div>
                <h3 class="font-medium">4. Analysis Complete</h3>
                <p id="detail-analysis" class="text-xs text-primary/55 dark:text-white/55">ç­‰å¾…éŸ³é¢‘å‡†å¤‡å®Œæˆ</p>
              </div>
            </div>
          </div>

          <div class="pt-5 border-t border-primary/10 dark:border-white/10">
            <button id="readyBtn" type="button" disabled class="w-full min-h-[44px] rounded-xl bg-primary/10 dark:bg-white/10 text-primary/40 dark:text-white/40 font-medium cursor-not-allowed flex items-center justify-center gap-2 transition-all">
              <span id="readyLabel">Processing...</span>
            </button>
            <p id="pipelineMessage" class="mt-3 text-xs text-primary/60 dark:text-white/60">ä¸Šä¼ å¹¶è§£æåå¯è¿›å…¥é˜…è¯»é¡µã€‚</p>
          </div>
        </article>
      </div>
    </section>
  </main>

  <nav class="fixed bottom-0 left-0 right-0 md:hidden bg-white/90 dark:bg-[#23211e]/90 backdrop-blur border-t border-primary/10 dark:border-white/10 flex justify-around py-2 z-50">
    <a href="../library_dashboard/code.html" class="min-h-[44px] min-w-[44px] flex items-center justify-center text-primary/60"><span class="material-icons-round">library_books</span></a>
    <a href="../the_study_reading_view/code.html" class="min-h-[44px] min-w-[44px] flex items-center justify-center text-primary/60"><span class="material-icons-round">auto_stories</span></a>
    <a href="../vocabulary_insights_sidebar/code.html" class="min-h-[44px] min-w-[44px] flex items-center justify-center text-primary/60"><span class="material-icons-round">school</span></a>
    <a href="./code.html" class="min-h-[44px] min-w-[44px] flex items-center justify-center text-primary"><span class="material-icons-round">upload_file</span></a>
  </nav>

  <script>
    (function () {
      const KEYS = {
        translationCache: "dfr_translation_cache_v1",
        migrationDone: "dfr_migration_v1_done",
        theme: "dfr_theme"
      };

      const pdfjsLib = window["pdfjs-dist/build/pdf"];
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      const dropZone = document.getElementById("dropZone");
      const browseBtn = document.getElementById("browseBtn");
      const fileInput = document.getElementById("fileInput");
      const fileName = document.getElementById("fileName");
      const fileStats = document.getElementById("fileStats");
      const statusBadge = document.getElementById("statusBadge");
      const readyBtn = document.getElementById("readyBtn");
      const readyLabel = document.getElementById("readyLabel");
      const pipelineMessage = document.getElementById("pipelineMessage");
      const themeToggle = document.getElementById("themeToggle");

      const TRANSLATE_API = "https://google-translate-pro.xingpeng278.workers.dev/v1/chat/completions";
      const TRANSLATE_KEY = "sk-liutianyi999";
      const TRANSLATE_MODEL = "google-translate-pro";

      async function callTranslateAPI(text) {
        const resp = await fetch(TRANSLATE_API, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${TRANSLATE_KEY}`
          },
          body: JSON.stringify({
            model: TRANSLATE_MODEL,
            messages: [
              { role: "system", content: "You are a translator. Translate the user message from English to Chinese. Only output the translation, nothing else." },
              { role: "user", content: text }
            ]
          })
        });
        if (!resp.ok) throw new Error(`Translate API HTTP ${resp.status}`);
        const data = await resp.json();
        const result = data?.choices?.[0]?.message?.content?.trim();
        if (!result) throw new Error("Empty translation");
        return result;
      }

      let translationCache = loadJson(KEYS.translationCache, {});
      let translationQueue = Promise.resolve();
      let lastTranslationRequestAt = 0;
      let preparedArticle = null;

      function loadJson(key, fallback) {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return fallback;
          return JSON.parse(raw);
        } catch (_error) {
          return fallback;
        }
      }

      function saveJson(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      }

      function delay(ms) {
        return new Promise((resolve) => window.setTimeout(resolve, ms));
      }

      function runMigrationV1() {
        if (localStorage.getItem(KEYS.migrationDone) === "true") return;

        const legacyRaw = localStorage.getItem("dfr_last_imported");
        if (legacyRaw) {
          try {
            const legacy = JSON.parse(legacyRaw);
            const article = {
              id: `article_${Date.now()}`,
              title: String(legacy.title || "Imported Text"),
              text: String(legacy.text || legacy.content || ""),
              translations: legacy.translations && typeof legacy.translations === "object" ? legacy.translations : {},
              createdAt: legacy.createdAt || new Date().toISOString(),
              progress: Number(legacy.progress || 0),
              status: legacy.status || "in_progress",
              lastSentenceIndex: Number(legacy.lastSentenceIndex || 0),
              updatedAt: new Date().toISOString()
            };
            if (article.text) {
              localStorage.setItem(article.id, JSON.stringify(article));
            }
          } catch (_error) {
            // ignore migration errors
          }
        }

        localStorage.setItem(KEYS.migrationDone, "true");
      }

      function applyThemeFromStorage() {
        const t = localStorage.getItem(KEYS.theme);
        if (t === "dark") {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }

      function toggleTheme() {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.setItem(KEYS.theme, isDark ? "dark" : "light");
      }

      function splitSentences(text) {
        return String(text || "")
          .replace(/\s+/g, " ")
          .split(/(?<=[.!?])\s+/)
          .map((s) => s.trim())
          .filter(Boolean);
      }

      function normalizeTranslationKey(sentence) {
        return sentence.trim().toLowerCase().replace(/\s+/g, " ");
      }

      async function translateSentence(sentence) {
        const key = normalizeTranslationKey(sentence);
        if (translationCache[key]) return translationCache[key];

        const runRequest = async () => {
          if (translationCache[key]) return translationCache[key];

          const wait = Math.max(0, 500 - (Date.now() - lastTranslationRequestAt));
          if (wait > 0) await delay(wait);
          lastTranslationRequestAt = Date.now();

          let translated = "ç¿»è¯‘æš‚ä¸å¯ç”¨";
          try {
            translated = await callTranslateAPI(sentence);
          } catch (_error) {
            translated = "ç¿»è¯‘æš‚ä¸å¯ç”¨ï¼ˆç½‘ç»œé”™è¯¯ï¼‰";
          }

          translationCache[key] = translated;
          saveJson(KEYS.translationCache, translationCache);
          return translated;
        };

        translationQueue = translationQueue.then(runRequest, runRequest);
        return translationQueue;
      }

      function setPipelineBadge(text, tone = "idle") {
        statusBadge.textContent = text;
        statusBadge.className = "px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border";
        if (tone === "active") {
          statusBadge.classList.add("bg-accent/10", "text-accent", "border-accent/20");
        } else if (tone === "done") {
          statusBadge.classList.add("bg-green-100", "text-green-700", "border-green-200");
        } else if (tone === "error") {
          statusBadge.classList.add("bg-red-100", "text-red-700", "border-red-200");
        } else {
          statusBadge.classList.add("bg-primary/10", "text-primary", "border-primary/20");
        }
      }

      function setStep(step, state, detail) {
        const row = document.getElementById(`step-${step}`);
        const icon = document.getElementById(`icon-${step}`);
        const detailNode = document.getElementById(`detail-${step}`);

        row.classList.remove("opacity-60", "opacity-100");
        row.classList.add(state === "pending" ? "opacity-60" : "opacity-100");

        icon.className = "mt-1 w-6 h-6 rounded-full";

        if (state === "pending") {
          icon.classList.add("border-2", "border-primary/25");
          icon.innerHTML = "";
        } else if (state === "active") {
          icon.classList.add("border-2", "border-accent", "border-t-transparent", "animate-spin");
          icon.innerHTML = "";
        } else if (state === "done") {
          icon.classList.add("bg-accent", "text-white", "flex", "items-center", "justify-center", "shadow", "shadow-accent/20");
          icon.innerHTML = '<span class="material-icons-round text-sm">check</span>';
        } else if (state === "error") {
          icon.classList.add("bg-red-500", "text-white", "flex", "items-center", "justify-center");
          icon.innerHTML = '<span class="material-icons-round text-sm">close</span>';
        }

        if (detailNode && typeof detail === "string") {
          detailNode.textContent = detail;
        }
      }

      function resetPipelineUI() {
        setPipelineBadge("Idle", "idle");
        setStep("parse", "pending", "ç­‰å¾…ä¸Šä¼ æ–‡ä»¶");
        setStep("translate", "pending", "ç­‰å¾…è§£æå®Œæˆ");
        setStep("audio", "pending", "ç­‰å¾…ç¿»è¯‘å®Œæˆ");
        setStep("analysis", "pending", "ç­‰å¾…éŸ³é¢‘å‡†å¤‡å®Œæˆ");

        readyBtn.disabled = true;
        readyBtn.className = "w-full min-h-[44px] rounded-xl bg-primary/10 dark:bg-white/10 text-primary/40 dark:text-white/40 font-medium cursor-not-allowed flex items-center justify-center gap-2 transition-all";
        readyLabel.textContent = "Processing...";
        pipelineMessage.textContent = "ä¸Šä¼ å¹¶è§£æåå¯è¿›å…¥é˜…è¯»é¡µã€‚";
      }

      function stripExtension(filename) {
        return filename.replace(/\.[^.]+$/, "").trim() || "Imported Text";
      }

      async function parsePdf(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        const pages = [];

        for (let i = 1; i <= pdf.numPages; i += 1) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          const text = content.items.map((item) => item.str).join(" ").replace(/\s+/g, " ").trim();
          if (text) pages.push(text);
        }

        return pages.join("\n\n");
      }

      async function parseDocx(file) {
        const arrayBuffer = await file.arrayBuffer();
        const result = await mammoth.extractRawText({ arrayBuffer });
        return String(result.value || "").replace(/\s+\n/g, "\n").trim();
      }

      async function parseTxt(file) {
        return String(await file.text()).trim();
      }

      async function parseEpub(file) {
        const arrayBuffer = await file.arrayBuffer();
        const book = ePub(arrayBuffer);
        await book.ready;
        await book.loaded.spine;

        const fragments = [];
        const items = book.spine.spineItems || [];
        for (let i = 0; i < items.length; i += 1) {
          const item = items[i];
          const doc = await item.load(book.load.bind(book));
          const text = (doc?.body?.innerText || doc?.documentElement?.textContent || "")
            .replace(/\s+/g, " ")
            .trim();
          if (text) fragments.push(text);
          item.unload();
        }

        book.destroy();
        return fragments.join("\n\n");
      }

      async function extractTextFromFile(file) {
        const lower = file.name.toLowerCase();
        if (lower.endsWith(".pdf")) return parsePdf(file);
        if (lower.endsWith(".docx")) return parseDocx(file);
        if (lower.endsWith(".txt")) return parseTxt(file);
        if (lower.endsWith(".epub")) return parseEpub(file);
        throw new Error("ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·ä¸Šä¼  PDF/DOCX/TXT/EPUB");
      }

      async function processFile(file) {
        if (!file) return;

        resetPipelineUI();
        preparedArticle = null;
        fileName.textContent = file.name;
        fileStats.textContent = `${(file.size / 1024).toFixed(1)} KB`;
        let activeStep = "parse";

        try {
          setPipelineBadge("Active", "active");
          setStep("parse", "active", "æ­£åœ¨æå–æ­£æ–‡...");

          const extractedText = (await extractTextFromFile(file)).replace(/\s+/g, " ").trim();
          if (!extractedText) {
            throw new Error("è§£æç»“æœä¸ºç©ºï¼Œè¯·å°è¯•å…¶ä»–æ–‡ä»¶ã€‚");
          }

          const sentences = splitSentences(extractedText);
          if (!sentences.length) {
            throw new Error("æœªè¯†åˆ«åˆ°è‹±æ–‡å¥å­ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹ã€‚");
          }

          setStep("parse", "done", `è§£æå®Œæˆï¼š${sentences.length} å¥ï¼Œçº¦ ${extractedText.split(/\s+/).length} è¯`);

          activeStep = "translate";
          setStep("translate", "active", "å¼€å§‹é€å¥ç¿»è¯‘...");
          const translations = {};
          for (let i = 0; i < sentences.length; i += 1) {
            translations[i] = await translateSentence(sentences[i]);
            if (i === 0 || (i + 1) % 5 === 0 || i === sentences.length - 1) {
              setStep("translate", "active", `ç¿»è¯‘è¿›åº¦ ${i + 1}/${sentences.length}`);
            }
          }
          setStep("translate", "done", `ç¿»è¯‘å®Œæˆï¼š${sentences.length} å¥`);

          activeStep = "audio";
          setStep("audio", "active", "å»ºç«‹æœ—è¯»é…ç½®...");
          await delay(450);
          setStep("audio", "done", "éŸ³é¢‘æŒ‰éœ€ç”Ÿæˆï¼ˆè¿›å…¥é˜…è¯»é¡µåè°ƒç”¨ TTSï¼‰");

          activeStep = "analysis";
          setStep("analysis", "active", "ç”ŸæˆåŸºç¡€ç»Ÿè®¡...");
          await delay(280);
          const words = extractedText.split(/\s+/).length;
          setStep("analysis", "done", `ç»Ÿè®¡å®Œæˆï¼š${words} è¯ / ${sentences.length} å¥`);

          const articleId = `article_${Date.now()}`;
          preparedArticle = {
            id: articleId,
            title: stripExtension(file.name),
            text: extractedText,
            translations,
            createdAt: new Date().toISOString(),
            progress: 0,
            status: "in_progress",
            lastSentenceIndex: 0,
            updatedAt: new Date().toISOString()
          };

          readyBtn.disabled = false;
          readyBtn.className = "w-full min-h-[44px] rounded-xl bg-accent hover:bg-accent/90 text-white font-medium shadow-lg shadow-accent/20 flex items-center justify-center gap-2 transition-all";
          readyLabel.textContent = "Ready to Read";
          pipelineMessage.textContent = "å…¨éƒ¨å¤„ç†å®Œæˆï¼Œç‚¹å‡»æŒ‰é’®è¿›å…¥é˜…è¯»é¡µã€‚";
          setPipelineBadge("Ready", "done");
        } catch (error) {
          console.error(error);
          setPipelineBadge("Error", "error");
          setStep(activeStep, "error", error.message || "å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚");
          pipelineMessage.textContent = `å¤±è´¥ï¼š${error.message || "å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•"}`;
        }
      }

      function handleReady() {
        if (!preparedArticle) return;
        localStorage.setItem(preparedArticle.id, JSON.stringify(preparedArticle));
        window.location.href = `../the_study_reading_view/code.html?article=${encodeURIComponent(preparedArticle.id)}`;
      }

      function setupEvents() {
        themeToggle.addEventListener("click", toggleTheme);

        browseBtn.addEventListener("click", () => fileInput.click());
        fileInput.addEventListener("change", (event) => {
          processFile(event.target.files?.[0]);
        });

        dropZone.addEventListener("dragover", (event) => {
          event.preventDefault();
          dropZone.classList.add("border-accent");
        });

        dropZone.addEventListener("dragleave", () => {
          dropZone.classList.remove("border-accent");
        });

        dropZone.addEventListener("drop", (event) => {
          event.preventDefault();
          dropZone.classList.remove("border-accent");
          processFile(event.dataTransfer.files?.[0]);
        });

        readyBtn.addEventListener("click", handleReady);
      }

      runMigrationV1();
      applyThemeFromStorage();
      resetPipelineUI();
      setupEvents();
    })();
  </script>
</body>
</html>
